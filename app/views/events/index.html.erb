<header id="top" class="page-header-container">
  <div class="w-container large">
    <p class="breadcrumb-text"><%= link_to "Home", root_path %> / What's Up</p>
    <h1 class="page-header-title">Calendario</h1>
    <div class="page-header-subtitle">Lorem ipsum dolor sit amet.</div>
  </div>
</header>
<main class="page-postheader">
  <div class="calendar-main-container w-container large">
    <div class="calendar-content-left">
      <div class="calendar-filters-container">
        <%= form_tag whats_on_calendario_path, method: :get do %>
        <%= text_field_tag :query,
          params[:query],
          class: "event-form-control",
          placeholder: "Cerca un evento"
        %>
        <%= submit_tag "Cerca", class: "btn" %>
        <% end %>
      </div>
      <div class="calendar-cards-container">
        <% if !@events.empty? %>
        <p class="result-message"><%= @events.all.count %> risultat<%= @events.all.count == 1 ? "o" : "i" %></p>
        <% @events.each do |event| %>
          <%= link_to event_path(event), class: "event-card-container" do %>
            <div class="event-card-img-container" style="background-image: url('<%= cl_image_path event.image %>');">
              <div class="event-card-category-label <%= event.categoria.downcase %>"><%= event.categoria %></div>
            </div>
            <div class="event-card-content-container">
              <h3 class="event-card-title"><%= event.titolo.truncate(40) %></h3>
              <div class="event-card-date-container">
                <%= image_tag "calendar-icon.svg", alt: "calendar", class: "image-3"%>
                <%  inizio = event.data_inizio
                    fine = event.data_fine
                    dash = event.data_inizio != event.data_fine ? " - " : ""
                %>
                <p><%= tag.time l(inizio, format: :short), datetime: inizio %><%= dash %><%= event.data_inizio != event.data_fine ? (tag.time l(fine, format: :short), datetime: fine) : "" %></p>
              </div>
              <p class="event-card-subtitle"><%= event.sottotitolo.truncate(140) %></p>
            </div>
          <% end %>
        <% end %>
        <% else %>
          <p class="result-message">Non ci sono eventi in programmazione.</p>
        <% end %>
      </div>
    </div>
    <aside class="calendar-aside-container">
      <div class="sticky">
        <% if @events.select { |e| e.featured } %>
          <h2 class="section-label-container pink">Mostre in corso</h2>
          <% featured = @events.select { |e| e.featured } %>
          <% @events.select { |e| e.featured }.each do |featured| %>
            <%= link_to "#", class: "event-card-container featured-card" do %>
              <div class="event-card-img-container" style="background-image: url('<%= cl_image_path featured.image %>');">
                <div class="event-card-category-label <%= featured.categoria.downcase %>"><%= featured.categoria %></div>
              </div>
              <div class="event-card-content-container">
                <h3 class="event-card-title"><%= featured.titolo %></h3>
                <div class="event-card-date-container">
                  <%= image_tag "calendar-icon.svg", alt: "calendar", class: "image-3"%>
                  <%  inizio = featured.data_inizio
                    fine = featured.data_fine
                    dash = featured.data_inizio != featured.data_fine ? " - " : ""
                  %>
                  <p><%= tag.time l(inizio, format: :short), datetime: inizio %><%= dash %><%= featured.data_inizio != featured.data_fine ? (tag.time l(fine, format: :short), datetime: fine) : "" %></p>
                </div>
                <!-- <p class="event-card-subtitle">Lorem ipsum dolor sit amet, consectetur adipisicing elit.</p> -->
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </aside>
  </div>
</main>

