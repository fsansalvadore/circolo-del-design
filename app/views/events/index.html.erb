<header id="top" class="page-header-container">
  <div class="w-container large">
    <div class="breadcrumb-text"><%= link_to "Home", root_path %> / What's On</div>
    <h1 class="page-header-title">Programma</h1>
    <div class="page-header-subtitle">I prossimi appuntamenti al Circolo del Design.</div>
  </div>
</header>
<main class="page-postheader">
  <div class="calendar-main-container w-container large">
    <div class="calendar-content-left">
      <div class="calendar-filters-container">
        <%= form_tag whats_on_programma_path, method: :get, class: "events-search-form" do %>
          <%= text_field_tag :query,
            params[:query],
            class: "event-form-control",
            placeholder: "Cerca un evento"
          %>
          <%= submit_tag "Cerca", class: "w-button" %>
        <% end %>
        <!-- Date select -->
        <%= form_tag events_by_month_path, method: :get, class: "month-filter-form" do %>
          <% months = %w(G F M A M G L A S O N D) %>
          <%# months = [Date.today.month, "F", "M", "A", "M", "G", "L", "A", "S", "O", "N", "D"] %>
          <% months.each_with_index do |m, i| %>
            <div class="month-checkbox-container" title="<%= Date::MONTHNAMES[i + 1] %>">
              <% current = i + 1 <= Date.current.month ? "current" : "" %>
              <%= check_box_tag "i", i + 1, false, {
                title: Date::MONTHNAMES[i + 1],
                class: "month-checkbox-default",
                onclick: "$('input[type=checkbox]').change(function() {
                            if($(this).prop('checked') == true) {
                              $('form.month-filter-form').submit();
                            }
                          });"} %>
              <%  if @monthSelect.to_i == i + 1
                    selected = "selected"
                  else
                    selected = ""
                  end
                %>
              <span class="month-checkbox <%= current %> <%= selected %>">
                <p><%= m %></p>
              </span>
            </div>
          <% end %>
        <% end %>
        <%= link_to whats_on_programma_path, {class: "form-reset-btn-contianer"} do %>
          <p>Azzera filtri</p>
          <div class="form-reset-btn"></div>
        <% end %>
      </div>
      <div class="calendar-cards-container">
        <% if !@events.empty? %>
        <p class="result-message"><%= @events.all.count %> risultat<%= @events.all.count == 1 ? "o" : "i" %></p>
        <% @events.each do |event| %>
          <%= link_to event_path(event), class: "event-card-container" do %>
            <div class="event-card-category-label <%= event.categoria.downcase %>"><%= event.categoria %></div>
            <div class="event-card-img-container" style="background-image: url('<%= cl_image_path event.image %>');">
            </div>
            <div class="event-card-content-container">
              <h3 class="event-card-title"><%= event.titolo.truncate(40) %></h3>
              <div class="event-card-date-container">
                <%= image_tag "calendar-icon.svg", alt: "calendar", class: "image-3"%>
                <%  inizio = event.data_inizio
                    fine = event.data_fine
                    dash = event.data_inizio != event.data_fine ? " - " : ""
                %>
                <p><%= tag.time l(inizio, format: :short), datetime: inizio %><%= dash %><%= event.data_inizio != event.data_fine ? (tag.time l(fine, format: :short), datetime: fine) : "" %></p>
              </div>
              <p class="event-card-subtitle"><%= event.sottotitolo.truncate(140) %></p>
            </div>
          <% end %>
        <% end %>
        <% else %>
          <p class="result-message">Nessun evento trovato.</p>
        <% end %>
      </div>
    </div>
    <aside class="calendar-aside-container">
      <div class="sticky">
        <% if @featured %>
          <h2 class="section-label-container pink">Mostre in corso</h2>
          <% featured = @events.select { |e| e.featured } %>
          <% @featured.each do |featured| %>
            <%= link_to "#", class: "event-card-container featured-card" do %>
              <div class="event-card-category-label <%= featured.categoria.downcase %>"><%= featured.categoria %></div>
              <div class="event-card-img-container" style="background-image: url('<%= cl_image_path featured.image %>');">
              </div>
              <div class="event-card-content-container">
                <h3 class="event-card-title"><%= featured.titolo %></h3>
                <div class="event-card-date-container">
                  <%= image_tag "calendar-icon.svg", alt: "calendar", class: "image-3"%>
                  <%  inizio = featured.data_inizio
                    fine = featured.data_fine
                    dash = featured.data_inizio != featured.data_fine ? " - " : ""
                  %>
                  <p><%= tag.time l(inizio, format: :short), datetime: inizio %><%= dash %><%= featured.data_inizio != featured.data_fine ? (tag.time l(fine, format: :short), datetime: fine) : "" %></p>
                </div>
                <!-- <p class="event-card-subtitle">Lorem ipsum dolor sit amet, consectetur adipisicing elit.</p> -->
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </aside>
  </div>
</main>

